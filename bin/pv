#!/bin/bash
# Push a version through a module's .info files

source ~/.bash_config/global/lib/shared/tools.inc

NEW_VERSION=$1

req_local NEW_VERSION

CORE=$(drupal_get_version_core)
OLD_VERSION=$(drupal_get_project_version_full)

# Ensure we found a core version
if [ -z "$CORE" ]; then
  echo "Unable to determine core version.  Project version not updated."
else
  # Change the version numbers while creating a backup
  find . -name '*.info' -print -exec sed -i.bak "s/version = $OLD_VERSION/version = $CORE-$NEW_VERSION/g" {} +

  # Remove the backup file
  find . -name '*.info.bak' -exec rm {} +
fi
